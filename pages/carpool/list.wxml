<!--pages/carpool/list.wxml-->
<view class="list-container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <input 
      class="search-input" 
      placeholder="æœç´¢æ‹¼è½¦æ´»åŠ¨..." 
      bindinput="onSearchInput"
      bindconfirm="onSearch"
      value="{{searchKeyword}}"
    />
    <view class="search-btn" bindtap="onSearch">ï¿½ï¿½</view>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view 
      class="filter-item {{filterStatus === 'all' ? 'active' : ''}}"
      data-status="all"
      bindtap="onFilterChange"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="filter-item {{filterStatus === 'æ‹›å‹Ÿä¸­' ? 'active' : ''}}"
      data-status="æ‹›å‹Ÿä¸­"
      bindtap="onFilterChange"
    >
      æ‹›å‹Ÿä¸­
    </view>
    <view 
      class="filter-item {{filterStatus === 'å·²æ»¡å‘˜' ? 'active' : ''}}"
      data-status="å·²æ»¡å‘˜"
      bindtap="onFilterChange"
    >
      å·²æ»¡å‘˜
    </view>
  </view>

  <!-- æ‹¼è½¦åˆ—è¡¨ -->
  <view class="carpool-list">
    <view wx:if="{{loading && carpools.length === 0}}" class="loading-container">
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <view wx:elif="{{carpools.length === 0}}" class="empty-container">
      <view class="empty-icon">ğŸš—</view>
      <view class="empty-text">æš‚æ— æ‹¼è½¦ä¿¡æ¯</view>
      <view class="empty-desc">å¿«æ¥å‘å¸ƒç¬¬ä¸€ä¸ªæ‹¼è½¦å§ï¼</view>
    </view>

    <view wx:else>
      <view 
        wx:for="{{carpools}}" 
        wx:key="_id" 
        class="carpool-item"
        data-id="{{item._id}}"
        bindtap="viewDetail"
      >
        <!-- æ‹¼è½¦å¤´éƒ¨ -->
        <view class="carpool-header">
          <view class="activity-name">{{item.activityName}}</view>
          <view class="carpool-status {{item.status === 'æ‹›å‹Ÿä¸­' ? 'recruiting' : 'full'}}">
            {{item.status}}
          </view>
        </view>

        <!-- æ‹¼è½¦ä¿¡æ¯ -->
        <view class="carpool-info">
          <view class="info-row">
            <text class="info-icon">ğŸ“…</text>
            <text class="info-text">{{item.date}} {{item.time}}</text>
          </view>
          <view class="info-row">
            <text class="info-icon">ğŸ“</text>
            <text class="info-text">{{item.startLocation}} â†’ {{item.endLocation}}</text>
          </view>
          <view class="info-row">
            <text class="info-icon">ğŸ‘¥</text>
            <text class="info-text">{{item.currentCount}}/{{item.maxCount}}äºº</text>
            <text class="price">Â¥{{item.price}}/äºº</text>
          </view>
        </view>

        <!-- å‘å¸ƒè€…ä¿¡æ¯ -->
        <view class="publisher-info">
          <image class="publisher-avatar" src="{{item.publisherInfo.avatarUrl}}" mode="aspectFill"></image>
          <view class="publisher-name">{{item.publisherInfo.nickName}}</view>
          <view class="publish-time">{{item.publishTimeText}}</view>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="carpool-actions" catchtap="stopPropagation">
          <view wx:if="{{item.status === 'æ‹›å‹Ÿä¸­'}}" class="action-buttons">
            <button 
              class="join-btn"
              data-id="{{item._id}}"
              bindtap="joinCarpool"
            >
              ç«‹å³åŠ å…¥
            </button>
          </view>
          <view wx:else class="full-tip">
            å·²æ»¡å‘˜
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loading && carpools.length > 0}}" class="load-more">
      <view class="loading-text">åŠ è½½æ›´å¤š...</view>
    </view>

    <view wx:if="{{!hasMore && carpools.length > 0}}" class="no-more">
      æ²¡æœ‰æ›´å¤šäº†
    </view>
  </view>

  <!-- å‘å¸ƒæŒ‰é’® -->
  <view class="fab-container">
    <navigator url="/pages/publish-carpool/publish-carpool" class="fab-btn">
      <text class="fab-icon">+</text>
    </navigator>
  </view>
</view>