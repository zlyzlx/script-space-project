<!--pages/my-carpools/my-carpools.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="header-title">æˆ‘å‘å¸ƒçš„æ‹¼è½¦</view>
    <view class="header-subtitle">ç®¡ç†ä½ å‘å¸ƒçš„æ‰€æœ‰æ‹¼è½¦æ´»åŠ¨</view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <view class="filter-tabs">
    <view class="tab-item {{statusFilter === '' ? 'active' : ''}}" 
          data-status="" 
          bindtap="onStatusFilterChange">
      å…¨éƒ¨
    </view>
    <view class="tab-item {{statusFilter === 'æ‹›å‹Ÿä¸­' ? 'active' : ''}}" 
          data-status="æ‹›å‹Ÿä¸­" 
          bindtap="onStatusFilterChange">
      æ‹›å‹Ÿä¸­
    </view>
    <view class="tab-item {{statusFilter === 'å·²æ»¡å‘˜' ? 'active' : ''}}" 
          data-status="å·²æ»¡å‘˜" 
          bindtap="onStatusFilterChange">
      å·²æ»¡å‘˜
    </view>
    <view class="tab-item {{statusFilter === 'å·²å®Œæˆ' ? 'active' : ''}}" 
          data-status="å·²å®Œæˆ" 
          bindtap="onStatusFilterChange">
      å·²å®Œæˆ
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-container">
    <view class="stat-item">
      <view class="stat-number">{{total}}</view>
      <view class="stat-label">æ€»æ‹¼è½¦æ•°</view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <view class="stat-number">{{recruitingCount}}</view>
      <view class="stat-label">æ‹›å‹Ÿä¸­</view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <view class="stat-number">{{totalParticipants}}</view>
      <view class="stat-label">æ€»å‚ä¸äººæ•°</view>
    </view>
  </view>

  <!-- æ‹¼è½¦åˆ—è¡¨ -->
  <view class="carpool-list">
    <view wx:if="{{loading && carpoolList.length === 0}}" class="loading-container">
      <view class="loading-spinner"></view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <view wx:elif="{{carpoolList.length === 0}}" class="empty-container">
      <view class="empty-icon">ğŸš—</view>
      <view class="empty-title">è¿˜æ²¡æœ‰å‘å¸ƒæ‹¼è½¦</view>
      <view class="empty-subtitle">å¿«å»å‘å¸ƒä½ çš„ç¬¬ä¸€ä¸ªæ‹¼è½¦æ´»åŠ¨å§</view>
      <button class="publish-btn" bindtap="publishNewCarpool">
        ç«‹å³å‘å¸ƒ
      </button>
    </view>

    <view wx:else>
      <view class="carpool-item" 
            wx:for="{{carpoolList}}" 
            wx:key="{{item._id}}"
            bindtap="viewCarpoolDetail"
            data-id="{{item._id}}">
        
        <!-- æ‹¼è½¦å¡ç‰‡ -->
        <view class="carpool-card">
          <!-- å¤´éƒ¨ä¿¡æ¯ -->
          <view class="card-header">
            <view class="activity-name">{{item.activityName}}</view>
            <view class="status-badge {{item.status === 'æ‹›å‹Ÿä¸­' ? 'recruiting' : item.status === 'å·²æ»¡å‘˜' ? 'full' : item.status === 'å·²å®Œæˆ' ? 'finished' : 'cancelled'}}">
              {{item.status}}
            </view>
          </view>

          <!-- åŸºæœ¬ä¿¡æ¯ -->
          <view class="card-content">
            <view class="info-row">
              <view class="info-icon">ğŸ“…</view>
              <view class="info-text">{{item.date}} {{item.time}}</view>
            </view>
            <view class="info-row">
              <view class="info-icon">ğŸ“</view>
              <view class="info-text">{{item.location}}</view>
            </view>
            <view class="info-row">
              <view class="info-icon">ğŸ‘¥</view>
              <view class="info-text">{{item.currentCount}}/{{item.maxCount}}äºº</view>
              <view class="info-icon">ğŸ’°</view>
              <view class="info-text">Â¥{{item.price}}/äºº</view>
            </view>
          </view>

          <!-- æ“ä½œæŒ‰é’® -->
          <view class="card-actions">
            <button class="action-btn secondary" 
                    bindtap="viewParticipants"
                    data-id="{{item._id}}"
                    catchtap="stopPropagation">
              æŸ¥çœ‹å‚ä¸è€…
            </button>
            
            <button wx:if="{{item.status === 'æ‹›å‹Ÿä¸­'}}" 
                    class="action-btn primary" 
                    bindtap="editCarpool"
                    data-id="{{item._id}}"
                    catchtap="stopPropagation">
              ç¼–è¾‘
            </button>
            
            <button wx:if="{{item.status === 'æ‹›å‹Ÿä¸­'}}" 
                    class="action-btn danger" 
                    bindtap="cancelCarpool"
                    data-id="{{item._id}}"
                    catchtap="stopPropagation">
              å–æ¶ˆ
            </button>
            
            <button class="action-btn secondary" 
                    bindtap="shareCarpool"
                    data-id="{{item._id}}"
                    catchtap="stopPropagation">
              åˆ†äº«
            </button>
          </view>

          <!-- å‘å¸ƒæ—¶é—´ -->
          <view class="publish-time">
            å‘å¸ƒäº {{item.publishTime}}
          </view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{hasMore}}" class="load-more">
        <view wx:if="{{loading}}" class="loading-more">
          <view class="loading-spinner small"></view>
          <text>åŠ è½½ä¸­...</text>
        </view>
        <view wx:else class="load-more-btn" bindtap="loadMoreCarpools">
          ç‚¹å‡»åŠ è½½æ›´å¤š
        </view>
      </view>

      <view wx:elif="{{!hasMore && carpoolList.length > 0}}" class="no-more">
        å·²åŠ è½½å…¨éƒ¨å†…å®¹
      </view>
    </view>
  </view>

  <!-- æ‚¬æµ®å‘å¸ƒæŒ‰é’® -->
  <view class="fab" bindtap="publishNewCarpool">
    <view class="fab-icon">+</view>
  </view>
</view> 